server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        return 200 '{"status":"ok"}';
        add_header Content-Type application/json;
    }

    # Mock OAuth authorization endpoint
    location /oauth/authorize {
        add_header Content-Type text/html;
        return 200 '<html><body><h1>Mock OAuth Provider</h1><form method="get" action="/oauth/callback"><input type="hidden" name="code" value="mock_auth_code_123"><input type="hidden" name="state" value="$arg_state"><button type="submit">Authorize</button></form></body></html>';
    }

    # Mock OAuth token endpoint
    location /oauth/token {
        add_header Content-Type application/json;
        return 200 '{
            "access_token": "mock_access_token_$request_id",
            "refresh_token": "mock_refresh_token_$request_id",
            "token_type": "Bearer",
            "expires_in": 3600,
            "scope": "read write"
        }';
    }

    # Mock user info endpoint
    location /api/user {
        add_header Content-Type application/json;
        return 200 '{
            "id": "mock_user_123",
            "email": "test@example.com",
            "name": "Test User",
            "given_name": "Test",
            "family_name": "User",
            "picture": "https://example.com/avatar.jpg"
        }';
    }

    # Mock OAuth callback (redirect)
    location /oauth/callback {
        return 302 $scheme://$host:8080/api/oauth/callback/$arg_provider?code=$arg_code&state=$arg_state;
    }

    # Default response
    location / {
        return 200 '{"service":"mock_oauth_provider"}';
        add_header Content-Type application/json;
    }
}